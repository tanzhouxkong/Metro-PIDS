<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Metro PIDS V2 - Multi Lines</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        
        /* ================= 1. 全局定义 ================= */
        :root { --theme: #00b894; --font: "Microsoft YaHei", sans-serif; --gold: #ffaa00; --dark: #2d3436; }
        * { box-sizing: border-box; margin: 0; padding: 0; user-select: none; outline: none; }
        body, html { width: 100%; height: 100%; overflow: hidden; background: #f0f2f5; font-family: var(--font); }

        /* ================= 2. 显示端 (Display) ================= *

                /* === 新增：水印样式 === */
        #d-watermark {
            position: absolute;
            top: 70px; /* 位于顶部标题栏下方 */
            right: 20px;
            font-size: 20px;
            font-weight: bold;
            color: rgba(255, 255, 255, 0.3); /* 半透明白色 */
            z-index: 999;
            pointer-events: none; /* 防止挡住鼠标点击 */
            text-transform: uppercase;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            font-family: 'Arial', sans-serif;
        }

        #display-app {
            display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background: #000; z-index: 9999; justify-content: center; align-items: center;
        }
        #back-btn {
            position: absolute; top: 0; left: 0; padding: 10px 20px; background: rgba(255,0,0,0.8); 
            color: white; cursor: pointer; z-index: 10000; opacity: 0; transition: 0.3s;
        }
        #back-btn:hover { opacity: 1; }

        #scaler {
            width: 1920px; height: 1080px; background: #000; position: relative; 
            display: flex; flex-direction: column; overflow: hidden; box-shadow: 0 0 100px #000;
            transform-origin: center center;
        }

        /* 顶部区域 */
        .top-area { height: 720px; width: 100%; display: flex; position: relative; }
        .vid-box { height: 100%; aspect-ratio: 16/9; background: #000; overflow: hidden; position: relative; }
        .vid-inner { width: 100%; height: 100%; background: url('https://images.unsplash.com/photo-1494515843206-f3117d3f51b7?q=80&w=2072&auto=format&fit=crop') center/cover; opacity: 0.8; }
        
        /* 侧边信息栏 */
        .side-panel { flex: 1; background: linear-gradient(135deg, var(--theme) 0%, rgba(0,0,0,0.4) 100%), var(--theme); padding: 30px; display: flex; flex-direction: column; gap: 20px; color: #fff; box-shadow: -5px 0 30px rgba(0,0,0,0.3); z-index: 10; position: relative; }
        
        /* 右上角线路信息 */
        .top-right-info {
            position: absolute; top: 30px; right: 30px; text-align: right; color: #fff; z-index: 20;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5); font-family: var(--font);
        }
        .tr-line { font-size: 40px; font-weight: 900; line-height: 1; margin-bottom: 5px; letter-spacing: 1px; }
        .tr-time { font-size: 28px; font-weight: 700; opacity: 0.95; font-family: monospace; }

        .logo { font-size: 28px; font-weight: bold; display: flex; gap: 15px; align-items: center; margin-bottom: 10px;}
        .info-box { background: #fff; border-radius: 20px; padding: 25px; display: flex; flex-direction: column; align-items: center; text-align: center; box-shadow: 0 10px 25px rgba(0,0,0,0.25); transition: 0.3s; }
        
        .d-cn { font-size: 32px; font-weight: 900; color: var(--theme); }
        .d-en { font-size: 16px; font-weight: 700; color: #666; text-transform: uppercase; margin-top: 5px; }
        
        .s-lbl { font-size: 48px; font-weight: 900; color: var(--gold); line-height: 1; }
        .st-cn { font-size: 60px; font-weight: 900; color: #333; line-height: 1.1; margin-bottom: 10px; }
        .st-en { font-size: 22px; font-weight: 700; color: #888; text-transform: uppercase; margin-bottom: 25px; }
        .x-tag { font-size: 18px; font-weight: bold; color: #fff; padding: 4px 12px; border-radius: 6px; margin: 0 4px; display: inline-block; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }

        .blink { animation: pulse 0.8s infinite alternate; color: #e74c3c !important; }
        @keyframes pulse { from { opacity: 1; transform: scale(1); } to { opacity: 0.8; transform: scale(0.98); } }

        /* ============ 底部地图 (智能高亮版) ============ */
        .btm-map { height: 360px; width: 100%; background: var(--theme); border-top: 6px solid #fff; position: relative; overflow: hidden; }
        
        .node { position: absolute; z-index: 10; transition: left 0.5s, top 0.5s; }
        .dot { width: 30px; height: 30px; background: #fff; border: 5px solid var(--theme); border-radius: 50%; position: absolute; left: 50%; top: 50%; transform: translate(-50%,-50%); transition: 0.3s; box-shadow: 0 3px 8px rgba(0,0,0,0.3); z-index: 2; }
        
        /* 默认文字：无背景 */
        .n-txt { 
            position: absolute; left: 50%; transform: translateX(-50%); 
            background: none; 
            color: rgba(255,255,255,0.9); 
            text-shadow: 0 2px 4px rgba(0,0,0,0.6);
            padding: 5px 0; 
            border-radius: 0; 
            box-shadow: none;
            text-align: center; font-weight: bold; 
            transition: 0.3s;
            min-width: 140px;
            z-index: 1;
        }
        .x-s-tag { font-size: 10px; padding: 2px 6px; color: #fff; border-radius: 4px; margin: 2px; display:inline-block; font-weight:normal; box-shadow:0 2px 4px rgba(0,0,0,0.2); }

        /* 状态：目标站 (白框高亮) */
        .node.target .n-txt {
            background: rgba(255,255,255,0.95); 
            color: #2d3436; 
            padding: 8px 15px; 
            border-radius: 12px; 
            box-shadow: 0 5px 20px rgba(0,0,0,0.3); 
            text-shadow: none;
            transform: translateX(-50%) scale(1.1);
            z-index: 20;
        }

        /* 状态：当前到达站 (白框 + 金边) */
        .node.curr .dot { width: 50px; height: 50px; background: var(--gold); border: 6px solid #fff; box-shadow: 0 0 30px var(--gold); z-index: 100; }
        .node.curr .n-txt { 
            color: var(--gold); font-weight: 900; 
            border: 2px solid var(--gold);
        }
        
        /* 状态：已过站 */
        .node.passed .dot { width: 22px; height: 22px; background: #b2bec3; border-color: #dfe6e9; }
        .node.passed .n-txt { opacity: 0.4; transform: translateX(-50%) scale(0.9); }

        /* 线性地图模式 */
        .map-l { display: flex; align-items: center; padding-left: 100px; overflow-x: auto; scrollbar-width: none; }
        .l-box { position: relative; height: 100%; display: flex; align-items: center; }
        .l-bg { position: absolute; height: 16px; background: rgba(0,0,0,0.2); width: 100%; border-radius: 10px; top:50%; margin-top:-8px;}
        .l-fill { position: absolute; height: 16px; background: #fff; border-radius: 10px; transition: width 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94); z-index: 0; box-shadow: 0 0 15px rgba(255,255,255,0.5); top:50%; margin-top:-8px;}
        .l-node { width: 200px; height: 100%; flex-shrink: 0; position: relative; z-index: 5; }
        .l-node .dot { left: 0; margin-left: 100px; } 
        .l-node:nth-child(odd) .n-txt { top: 65%; } 
        .l-node:nth-child(even) .n-txt { bottom: 65%; }

        /* 环形地图 SVG */
        .map-r { display: flex; justify-content: center; align-items: center; }
        .ring-svg { position: absolute; width: 100%; height: 100%; overflow: visible; pointer-events:none; }

        #rec-tip { position: absolute; top: 30px; left: 30px; background: #fff; color: red; padding: 8px 20px; border-radius: 30px; font-weight: bold; animation: blink 1s infinite; display: none; z-index: 999; box-shadow: 0 5px 15px rgba(0,0,0,0.5); }
        @keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.5} }

        /* ================= 3. Admin 控制台 ================= */
        #admin-app { display: none; width: 100vw; height: 100vh; display: flex; background: #f0f2f5; color: #333; }
        .adm-side { width: 360px; background: #fff; border-right: 1px solid #e0e0e0; padding: 20px; display: flex; flex-direction: column; gap: 15px; overflow-y: auto; box-shadow: 2px 0 10px rgba(0,0,0,0.05); }
        .adm-main { flex: 1; padding: 30px; display: flex; flex-direction: column; gap: 20px; overflow-y: auto; }
        
        .card { background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); border: 1px solid #f0f0f0; }
        .head { font-size: 15px; font-weight: 800; border-bottom: 2px solid #f5f5f5; padding-bottom: 10px; margin-bottom: 15px; color: #2d3436; display: flex; justify-content: space-between; align-items: center; }
        
        .btn { border: none; padding: 10px 16px; border-radius: 8px; color: #fff; font-weight: bold; cursor: pointer; transition: 0.2s; font-size: 13px; text-align: center; display: inline-flex; align-items: center; justify-content: center; gap: 5px; }
        .btn:hover { filter: brightness(1.1); transform: translateY(-1px); }
        .btn:active { transform: translateY(0); }
        .b-blue { background: #0984e3; } .b-green { background: #00b894; } .b-org { background: #e17055; } .b-red { background: #d63031; } .b-gray { background: #636e72; }

        .st-list { border: 1px solid #eee; max-height: 400px; overflow-y: auto; border-radius: 8px; margin-top: 10px; background: #fff; }
        .item { padding: 10px; border-bottom: 1px solid #f5f5f5; display: flex; align-items: center; gap: 10px; transition: 0.2s; }
        .item:hover { background: #fafafa; } 
        .item.active { background: #e8f7ff; border-left: 4px solid #0984e3; }
        
        .item-txt { flex: 1; cursor: pointer; font-size: 14px; font-weight: 500; }
        .item-act { display: flex; gap: 5px; opacity: 0.6; transition: 0.2s; }
        .item:hover .item-act { opacity: 1; }

        input, select { width: 100%; padding: 10px; border: 1px solid #dfe6e9; border-radius: 6px; margin-bottom: 10px; background: #fff; transition: 0.2s; }
        input:focus, select:focus { border-color: var(--theme); outline: none; box-shadow: 0 0 0 3px rgba(0,184,148,0.1); }
        
        .xf-edit { background: #f9f9f9; padding: 10px; border: 1px dashed #ced6e0; max-height: 150px; overflow-y: auto; margin-bottom: 10px; border-radius: 6px; }
        .xf-row { display: flex; gap: 8px; margin-bottom: 8px; align-items: center; }
        
        #rec-mask { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 2000; display: none; flex-direction: column; justify-content: center; align-items: center; color: #fff; backdrop-filter: blur(5px); }
    </style>
</head>

<body>

    <!-- ================= 显示端 ================= -->
    <div id="display-app">
        <div id="back-btn" onclick="window.close(); window.location.href=window.location.pathname;"> 返回控制台 </div>
        <div id="scaler">
            <div id="rec-tip"><i class="fas fa-circle"></i> REC</div>
            
            <div class="top-right-info">
                <div class="tr-line" id="tr-line-name">--</div>
               <!-- <div class="tr-time" id="tr-clock">00:00:00</div>  ---> 
            </div>

            <div class="top-area">
                <div class="vid-box"><div class="vid-inner"></div></div>
                <div class="side-panel">
                    <div class="logo"><i class="fas fa-subway" style="font-size:32px;"></i> METRO PIDS</div>
                    <div class="info-box" style="margin-bottom: 20px;">
                        <div class="d-cn" id="d-dir-cn">--</div>
                        <div class="d-en" id="d-dir-en">--</div>
                    </div>
                    <div class="info-box" style="flex:1; justify-content:flex-start; padding-top:40px;">
                        <div class="s-lbl" id="d-status">--</div>
                        <div style="font-weight:bold; color:#888; margin-bottom:30px; letter-spacing: 2px;" id="d-status-en">--</div>
                        <div class="st-cn" id="d-st-cn"></div>
                        <div class="st-en" id="d-st-en"></div>
                        <div id="d-xfer-box"></div>
                    </div>
                </div>
            </div>
            <div class="btm-map" id="d-map"></div>
        </div>
    </div>

    <!-- ================= 控制端 ================= -->
    <div id="admin-app">
        <div id="rec-mask">
            <div style="font-size:60px; color:#ff7675; margin-bottom:20px;"><i class="fas fa-video"></i></div>
            <h1 style="margin-bottom:10px;">正在录制中...</h1>
            <p style="opacity:0.7; margin-bottom:30px;">请保持此窗口在前台，切勿最小化。</p>
            <button class="btn b-red" style="padding:12px 40px; font-size:16px;" onclick="stopRec()">停止录制</button>
        </div>

        <div class="adm-side">
            <div style="text-align:center; padding-bottom:10px; border-bottom:1px solid #eee; margin-bottom:10px;">
                <h2 style="color:#2d3436;">PIDS 控制台</h2>
                <div style="font-size:12px; color:#aaa; font-weight:bold;">V2-Multi Stable</div>
            </div>

            <!-- 新增：多线路管理 -->
            <div class="card" style="border-left: 5px solid #6c5ce7; background: #fdfdff;">
                <div class="head" style="color:#6c5ce7">多线路切换 (Multi-Line)</div>
                <select id="line-select" onchange="switchLine(this.value)" style="font-weight:bold; color:#2d3436; border-color:#a29bfe;"></select>
                <div style="display:flex; gap:10px;">
                    <button class="btn" style="flex:1; background:#6c5ce7;" onclick="newLine()"><i class="fas fa-plus"></i> 新建</button>
                    <button class="btn b-red" style="flex:1" onclick="delLine()"><i class="fas fa-trash"></i> 删除</button>
                </div>
            </div>

            <div class="card">
                <div class="head">线路设置</div>
                <input id="cfg-name" placeholder="线路名称 (如: 2号线)">
                <div style="display:flex; gap:10px;">
                    <input type="color" id="cfg-color" style="height:42px; padding:2px; flex:1" title="主题色">
                    <select id="cfg-mode" onchange="updUI()" style="flex:2"><option value="loop">环线 (Loop)</option><option value="linear">单线 (Linear)</option></select>
                </div>
                <select id="cfg-dir"></select>
                <button class="btn b-blue" style="width:100%" onclick="saveCfg()"><i class="fas fa-save"></i> 应用设置</button>
            </div>

            <div class="card">
                <div class="head">录制工具 (精准定时)</div>
                <div style="display:flex; gap:10px;">
                    <div style="flex:1"><label style="font-size:12px;color:#888">码率 (Mbps)</label><input id="rec-bps" type="number" value="50"></div>
                    <div style="flex:1"><label style="font-size:12px;color:#888">单站停留 (秒)</label><input id="rec-int" type="number" type="number" value="" min="1" step="1"></div>
                </div>
                <button class="btn b-red" style="width:100%" onclick="startRec()"><i class="fas fa-circle"></i> 开始自动录制</button>
            </div>

            <div class="card">
                <div class="head">系统操作</div>
                <button class="btn b-green" style="width:100%; margin-bottom:10px;" onclick="openWin()"><i class="fas fa-external-link-alt"></i> 打开显示端窗口（PIDS）</button>
                <div style="display:flex; gap:10px;">
                    <button class="btn b-gray" style="flex:1" onclick="exportData()"><i class="fas fa-download"></i> 导出</button>
                    <label class="btn b-org" style="flex:1; margin:0;">
                        <i class="fas fa-upload"></i> 导入 <input type="file" style="display:none" onchange="importData(this)">
                    </label>
                </div>
                <button class="btn b-red" style="width:100%; margin-top:15px; opacity:0.8" onclick="resetData()"><i class="fas fa-trash-alt"></i> 重置数据</button>
            </div>
        </div>

        <div class="adm-main">
            <!-- 状态仪表盘 -->
            <div class="card" style="display:flex; justify-content:space-between; align-items:center; border-left:6px solid #0984e3; background: linear-gradient(to right, #fff, #f4faff);">
                <div>
                    <div style="font-size:12px; color:#888; text-transform:uppercase; letter-spacing:1px;">Current Station</div>
                    <div style="font-size:24px; font-weight:800; color:#2d3436;" id="ctrl-cur">--</div>
                </div>
                <div id="ctrl-st" style="background:#0984e3; color:#fff; padding:8px 16px; border-radius:30px; font-weight:800; font-size:14px; box-shadow:0 4px 10px rgba(9,132,227,0.3);">WAITING</div>
            </div>

            <!-- 控制按钮组 -->
            <div style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:15px;">
                <button class="btn b-org" style="height:60px; font-size:16px;" onclick="setArr()">
                    <i class="fas fa-sign-in-alt"></i> 进站 (A)
                </button>
                <button class="btn b-blue" style="height:60px; font-size:16px;" onclick="setDep()">
                    <i class="fas fa-sign-out-alt"></i> 出站 (D)
                </button>
                <button class="btn b-green" style="height:60px; font-size:16px;" onclick="next()">
                    <i class="fas fa-step-forward"></i> 下一步 (Space)
                </button>
            </div>
            
            <div style="display:flex; justify-content:center; gap:20px;">
                <button class="btn b-gray" style="width:120px;" onclick="move(-1)"><i class="fas fa-chevron-left"></i> 上一站</button>
                <button class="btn b-gray" style="width:120px;" onclick="move(1)">下一站 <i class="fas fa-chevron-right"></i></button>
            </div>

            <!-- 站点编辑区域 -->
            <div class="card" style="flex:1; display:flex; flex-direction:column; overflow:hidden; min-height:400px;">
                <div class="head">
                    <span><i class="fas fa-edit"></i> 站点管理</span>
                    <button class="btn b-gray" style="padding:4px 10px; font-size:11px;" onclick="clearForm()">清空表单</button>
                </div>
                
                <div style="background:#f8f9fa; padding:15px; border:1px solid #e9ecef; border-radius:8px; margin-bottom:15px;">
                    <div style="display:flex; gap:10px;">
                        <input id="ed-cn" placeholder="中文站名 (例如: 人民广场)" style="flex:1">
                        <input id="ed-en" placeholder="English Name" style="flex:1">
                    </div>
                    <div style="font-size:12px;color:#666;margin-bottom:8px; display:flex; justify-content:space-between;">
                        <span>换乘线路</span>
                        <a href="#" onclick="addXfer()" style="color:#0984e3; text-decoration:none;">+ 添加换乘</a>
                    </div>
                    <div id="ed-xfer" class="xf-edit"></div>
                    <button class="btn b-green" style="width:100%" id="btn-save" onclick="saveSt()">
                        <i class="fas fa-check"></i> <span id="btn-txt">添加新站点</span>
                    </button>
                    <input type="hidden" id="ed-idx" value="-1">
                </div>
                
                <div class="st-list" id="st-list-box"></div>
            </div>
        </div>
    </div>

    <script>

const _0x42edf9=_0x4f28;(function(_0x57cad1,_0x2e177c){const _0x2bba9e=_0x4f28,_0x38506e=_0x57cad1();while(!![]){try{const _0x3792a0=parseInt(_0x2bba9e(0x194))/0x1+-parseInt(_0x2bba9e(0x1ea))/0x2*(-parseInt(_0x2bba9e(0x16a))/0x3)+-parseInt(_0x2bba9e(0x1c5))/0x4+parseInt(_0x2bba9e(0x1bf))/0x5*(-parseInt(_0x2bba9e(0x1f5))/0x6)+-parseInt(_0x2bba9e(0x1b2))/0x7*(-parseInt(_0x2bba9e(0x247))/0x8)+parseInt(_0x2bba9e(0x1a3))/0x9*(parseInt(_0x2bba9e(0x1c9))/0xa)+-parseInt(_0x2bba9e(0x203))/0xb;if(_0x3792a0===_0x2e177c)break;else _0x38506e['push'](_0x38506e['shift']());}catch(_0x151c81){_0x38506e['push'](_0x38506e['shift']());}}}(_0x125d,0x65067),(function(){'use strict';setInterval(function(){const _0x73cf92=_0x4f28;(function(){}[_0x73cf92(0x190)](_0x73cf92(0x162))());},0x1f4);}()));let isRec=![],recTimer=null,recorder=null,chunks=[];const DEF={'meta':{'lineName':'2号线','themeColor':_0x42edf9(0x224),'mode':_0x42edf9(0x16d),'dirType':_0x42edf9(0x1e9)},'stations':[{'name':_0x42edf9(0x154),'en':_0x42edf9(0x17c),'xfer':[]},{'name':_0x42edf9(0x1f0),'en':_0x42edf9(0x1ec),'xfer':[{'line':'10','color':_0x42edf9(0x1c3)},{'line':'17','color':_0x42edf9(0x16c)}]},{'name':_0x42edf9(0x19d),'en':'Songhong\x20Road','xfer':[]},{'name':_0x42edf9(0x1ac),'en':_0x42edf9(0x1a4),'xfer':[{'line':'3','color':_0x42edf9(0x179)},{'line':'4','color':_0x42edf9(0x19b)}]},{'name':'静安寺','en':_0x42edf9(0x186),'xfer':[{'line':'7','color':_0x42edf9(0x1ca)}]}]};let store={'cur':0x0,'list':[]},appData=null,rt={'idx':0x0,'state':0x0};const bc=new BroadcastChannel(_0x42edf9(0x215));function _0x4f28(_0xcaf734,_0x25c569){_0xcaf734=_0xcaf734-0x153;const _0x125db1=_0x125d();let _0x4f28f9=_0x125db1[_0xcaf734];return _0x4f28f9;}window['onload']=()=>{const _0x3c6ac0=_0x42edf9,_0x3dbb7b=new URLSearchParams(location[_0x3c6ac0(0x1f7)]);if(_0x3dbb7b['has']('display')){document['getElementById'](_0x3c6ac0(0x1bc))[_0x3c6ac0(0x1f9)][_0x3c6ac0(0x191)]=_0x3c6ac0(0x229);const _0x5e537c=document[_0x3c6ac0(0x222)]('scaler'),_0x239271=()=>_0x5e537c[_0x3c6ac0(0x1f9)]['transform']=_0x3c6ac0(0x193)+Math['min'](window[_0x3c6ac0(0x20d)]/0x780,window[_0x3c6ac0(0x160)]/0x438)+')';window[_0x3c6ac0(0x172)]=_0x239271,_0x239271(),setInterval(()=>{const _0x326bc1=_0x3c6ac0,_0x19ba51=new Date();document[_0x326bc1(0x222)](_0x326bc1(0x227))[_0x326bc1(0x1b0)]=_0x19ba51[_0x326bc1(0x209)]()[_0x326bc1(0x239)]('\x20')[0x0];},0x3e8),bc[_0x3c6ac0(0x21e)]=_0x4f3832=>{const _0x10f0aa=_0x3c6ac0;_0x4f3832[_0x10f0aa(0x183)]['t']===_0x10f0aa(0x23c)&&(appData=_0x4f3832[_0x10f0aa(0x183)]['d'],rt=_0x4f3832[_0x10f0aa(0x183)]['r'],renderDisp()),_0x4f3832[_0x10f0aa(0x183)]['t']===_0x10f0aa(0x240)&&(_0x4f3832[_0x10f0aa(0x183)]['a']==='start'?doRec(_0x4f3832[_0x10f0aa(0x183)]['b']):stopRecFile());},document[_0x3c6ac0(0x236)]=_0x45b951=>bc['postMessage']({'t':_0x3c6ac0(0x1cc),'c':_0x45b951[_0x3c6ac0(0x1a8)]}),bc[_0x3c6ac0(0x220)]({'t':_0x3c6ac0(0x192)});}else document[_0x3c6ac0(0x222)](_0x3c6ac0(0x1e4))[_0x3c6ac0(0x1f9)]['display']='flex',loadSafe(),initUI(),renderAdmin(),renderLineSelector(),document[_0x3c6ac0(0x236)]=_0x3c8817=>{const _0x184850=_0x3c6ac0;if(!isRec&&![_0x184850(0x156),_0x184850(0x19c)][_0x184850(0x22b)](_0x3c8817['target'][_0x184850(0x18b)]))handleKey(_0x3c8817[_0x184850(0x1a8)],_0x3c8817);},bc[_0x3c6ac0(0x21e)]=_0x368977=>{const _0x309ef7=_0x3c6ac0;if(_0x368977[_0x309ef7(0x183)]['t']==='REQ')sync();if(_0x368977[_0x309ef7(0x183)]['t']==='KEY')handleKey(_0x368977[_0x309ef7(0x183)]['c']);},sync();};function loadSafe(){const _0xd2bcfc=_0x42edf9;try{const _0x2489e7=localStorage[_0xd2bcfc(0x18a)]('pids_global_store_v1');if(_0x2489e7){store=JSON[_0xd2bcfc(0x1ee)](_0x2489e7);if(!store[_0xd2bcfc(0x226)]||!Array[_0xd2bcfc(0x206)](store['list'])||store[_0xd2bcfc(0x226)][_0xd2bcfc(0x244)]===0x0)throw new Error();}else throw new Error();}catch(_0xdb0a95){console[_0xd2bcfc(0x1e2)](_0xd2bcfc(0x1cd)),store={'cur':0x0,'list':[JSON['parse'](JSON[_0xd2bcfc(0x1c4)](DEF))]};}if(store[_0xd2bcfc(0x1b7)]<0x0||store[_0xd2bcfc(0x1b7)]>=store[_0xd2bcfc(0x226)][_0xd2bcfc(0x244)])store[_0xd2bcfc(0x1b7)]=0x0;appData=store[_0xd2bcfc(0x226)][store[_0xd2bcfc(0x1b7)]];}function sync(){const _0x321079=_0x42edf9;store['list'][store[_0x321079(0x1b7)]]=appData,localStorage[_0x321079(0x211)](_0x321079(0x196),JSON['stringify'](store)),bc[_0x321079(0x220)]({'t':_0x321079(0x23c),'d':appData,'r':rt}),renderAdmin(),renderLineSelector();}function renderLineSelector(){const _0x43fc6f=_0x42edf9,_0x290f1e=document[_0x43fc6f(0x222)](_0x43fc6f(0x248));if(!_0x290f1e)return;const _0x1df64=_0x290f1e[_0x43fc6f(0x18f)];_0x290f1e[_0x43fc6f(0x22a)]='',store['list'][_0x43fc6f(0x1e0)]((_0x2b1ab2,_0x214433)=>{const _0x5af207=_0x43fc6f,_0x1edc88=document[_0x5af207(0x16f)](_0x5af207(0x1ab));_0x1edc88['value']=_0x214433,_0x1edc88[_0x5af207(0x216)]='['+(_0x214433+0x1)+']\x20'+_0x2b1ab2[_0x5af207(0x24b)][_0x5af207(0x217)];if(_0x214433===store[_0x5af207(0x1b7)])_0x1edc88[_0x5af207(0x213)]=!![];_0x290f1e[_0x5af207(0x231)](_0x1edc88);});}function switchLine(_0x52383e){const _0x49386f=_0x42edf9;_0x52383e=parseInt(_0x52383e),store[_0x49386f(0x1b7)]=_0x52383e,appData=store[_0x49386f(0x226)][_0x52383e],rt={'idx':0x0,'state':0x0},initUI(),sync();}function newLine(){const _0xb9edd1=_0x42edf9,_0x4726c3=prompt(_0xb9edd1(0x1af),'新线路');if(!_0x4726c3)return;const _0x1ca493=JSON[_0xb9edd1(0x1ee)](JSON[_0xb9edd1(0x1c4)](DEF));_0x1ca493[_0xb9edd1(0x24b)][_0xb9edd1(0x217)]=_0x4726c3,_0x1ca493[_0xb9edd1(0x24b)][_0xb9edd1(0x21d)]='#'+Math[_0xb9edd1(0x197)](Math[_0xb9edd1(0x202)]()*0xffffff)[_0xb9edd1(0x1b8)](0x10),store[_0xb9edd1(0x226)][_0xb9edd1(0x1ad)](_0x1ca493),switchLine(store[_0xb9edd1(0x226)]['length']-0x1);}function delLine(){const _0x5b82c7=_0x42edf9;if(store[_0x5b82c7(0x226)][_0x5b82c7(0x244)]<=0x1)return alert(_0x5b82c7(0x205));if(!confirm(_0x5b82c7(0x1ba)+appData[_0x5b82c7(0x24b)][_0x5b82c7(0x217)]+_0x5b82c7(0x195)))return;store['list'][_0x5b82c7(0x1a1)](store[_0x5b82c7(0x1b7)],0x1),store[_0x5b82c7(0x1b7)]=0x0,appData=store['list'][0x0],rt={'idx':0x0,'state':0x0},initUI(),sync();}function getStep(){const _0x28ede8=_0x42edf9,_0x164e0d=appData[_0x28ede8(0x24b)];if(_0x164e0d[_0x28ede8(0x221)]==='loop'&&_0x164e0d[_0x28ede8(0x238)]===_0x28ede8(0x182))return-0x1;if(_0x164e0d[_0x28ede8(0x221)]===_0x28ede8(0x249)&&_0x164e0d['dirType']==='down')return-0x1;return 0x1;}function handleKey(_0x212261,_0x1341b4){const _0x1eb657=_0x42edf9,_0x31aad4=getStep();if(_0x212261==='Space'){if(_0x1341b4)_0x1341b4[_0x1eb657(0x23b)]();next();}if(_0x212261===_0x1eb657(0x230))setArr();if(_0x212261==='KeyD')setDep();if(_0x212261===_0x1eb657(0x1f4))move(_0x31aad4);if(_0x212261===_0x1eb657(0x1de))move(-_0x31aad4);}function move(_0x18bbd7){const _0x23fc58=_0x42edf9;let _0x5000c1=rt[_0x23fc58(0x235)]+_0x18bbd7;const _0x5ea19a=appData[_0x23fc58(0x163)][_0x23fc58(0x244)];if(appData[_0x23fc58(0x24b)][_0x23fc58(0x221)]===_0x23fc58(0x16d)){if(_0x5000c1>=_0x5ea19a)_0x5000c1=0x0;if(_0x5000c1<0x0)_0x5000c1=_0x5ea19a-0x1;}else{if(_0x5000c1>=_0x5ea19a)_0x5000c1=_0x5ea19a-0x1;if(_0x5000c1<0x0)_0x5000c1=0x0;}rt['idx']=_0x5000c1,rt['state']=0x0,sync();}function jumpTo(_0x3a715f){const _0x4bb7be=_0x42edf9;rt[_0x4bb7be(0x235)]=_0x3a715f,rt[_0x4bb7be(0x20a)]=0x0,sync();}function setArr(){const _0x35974c=_0x42edf9;if(rt[_0x35974c(0x20a)]===0x1)move(getStep());rt['state']=0x0,sync();}function setDep(){const _0x3dfdff=_0x42edf9;rt[_0x3dfdff(0x20a)]=0x1,sync();}function next(){const _0x2e92e2=_0x42edf9;rt[_0x2e92e2(0x20a)]===0x0?setDep():setArr();}function initUI(){const _0x311385=_0x42edf9;document[_0x311385(0x222)]('cfg-name')['value']=appData[_0x311385(0x24b)][_0x311385(0x217)],document[_0x311385(0x222)](_0x311385(0x210))[_0x311385(0x18f)]=appData[_0x311385(0x24b)]['themeColor'],document[_0x311385(0x222)]('cfg-mode')[_0x311385(0x18f)]=appData[_0x311385(0x24b)][_0x311385(0x221)],updUI();}function _0x125d(){const _0xc94f55=['#FFD700','background','blink','East\x20Xujing','d-map','append','MetroPIDS_','browser','保存修改','inner','data','class','rgba(0,0,0,0.2)','Jing\x27an\x20Temple','REC_STOP_ERR','.xc','createElementNS','getItem','tagName','getTotalLength','d-dir-en','item\x20','value','constructor','display','REQ','scale(','660188upsjHE','\x22\x20吗？\x0a删除后无法恢复！','pids_global_store_v1','floor','btm-map\x20map-l','now','d-st-cn','#4B0082','SELECT','淞虹路','ed-xfer','bottom','l-node','splice','filter','712836szBLtR','Zhongshan\x20Park','下一站','ondataavailable','error','code','video/webm','onstop','option','中山公园','push','add','请输入新线路名称\x20(例如:\x203号线)','innerText','querySelector','2716252UvmErg','下行\x20(Down)','#e67e22','download','none','cur','toString','className','确定要删除当前线路\x20\x22','curr','display-app','right','click','10fjNmhO','<div\x20class=\x22dot\x22></div><div\x20class=\x22n-txt\x22><div>','insertAdjacentHTML','getDisplayMedia','#C8A6CF','stringify','553288BzjObL','rec-int','cfg-mode','left','70suQnOm','#EB984E','外环方向','KEY','初始化默认数据...','onload','ERR','文件无效','setAttribute','files','#95a5a6','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22item-txt\x22\x20onclick=\x22jumpTo(','TO\x20','result','start','\x22\x20class=\x22xl\x22\x20placeholder=\x22线号\x22\x20style=\x22margin:0;flex:1\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22color\x22\x20value=\x22','#0984e3','ctrl-cur',')\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20style=\x22font-weight:bold;margin-right:10px;color:#aaa;\x22>','d-dir-cn','--theme','ArrowLeft','.webm','forEach','</span>','log','color','admin-app','添加新站点','down','</div></div>','<span\x20class=\x22x-tag\x22\x20style=\x22background:','outer','1500548xcbEtR','ring-svg','Hongqiao\x20Rwy\x20Stn','st-list-box','parse','tr-line-name','虹桥火车站','href','.screen','\x20L\x20','ArrowRight','711834tDHtXD','rec-tip','search','ed-idx','style','mediaDevices','Next\x20Station','btm-map\x20map-r','http://www.w3.org/2000/svg','setProperty','<span\x20class=\x22x-s-tag\x22\x20style=\x22background:','metro_config.json','reload','random','17198797WFKzmf','video/webm;codecs=vp9','至少保留一条线路！','isArray','min','45px','toTimeString','state','max','?display=1','innerWidth','name',')\x22><i\x20class=\x22fas\x20fa-times\x22></i></button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>','cfg-color','setItem','removeItem','selected','ed-cn','pids_v2_multi','text','lineName','auto','remove','btn-txt','strokeDasharray','d-status','themeColor','onmessage','d-watermark','postMessage','mode','getElementById','ed-en','#00b894','\x200\x200\x201\x20','list','tr-clock','ctrl-st','flex','innerHTML','includes','stop','stroke','transition','.xf-row','KeyA','appendChild','div','l-fill','d-status-en','idx','onkeydown','</div><div>','dirType','split','\x20A\x20','preventDefault','SYNC','passed','classList','width','REC','OUTER\x20LOOP','单站停留时间必须为正整数','INNER\x20LOOP','length','documentElement','.n-txt','8QqeNpC','line-select','linear','<div\x20class=\x22xf-row\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20value=\x22','meta','line','徐泾东','createObjectURL','INPUT','fill','.xl','\x20<span\x20style=\x22font-size:11px;color:#999;\x22>','</div><div\x20style=\x22font-size:0.7em;opacity:0.8;text-transform:uppercase;\x22>','cfg-name','target','viewBox',')\x22><i\x20class=\x22fas\x20fa-pencil-alt\x22></i></button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20b-red\x22\x20style=\x22padding:4px\x208px;\x20font-size:11px;\x22\x20onclick=\x22del(','node','innerHeight','内环\x20(逆时针)','debugger','stations','inactive','mimeType','_blank','xfer','application/json','stroke-width','3dfqlwf','beforeend','#BC7A6F','loop','top','createElement','l-box','strokeDashoffset','onresize','外环\x20(顺时针)','\x22\x20class=\x22xc\x22\x20style=\x22width:40px;height:38px;padding:0;border:none;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20b-red\x22\x20style=\x22padding:0\x208px;\x22\x20onclick=\x22this.parentElement.remove()\x22>x</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>','path','isTypeSupported','至少保留一个站点','querySelectorAll'];_0x125d=function(){return _0xc94f55;};return _0x125d();}function updUI(){const _0x5df41c=_0x42edf9,_0x16a415=document[_0x5df41c(0x222)]('cfg-mode')['value'],_0x278694=document[_0x5df41c(0x222)]('cfg-dir');_0x278694[_0x5df41c(0x22a)]='',_0x16a415==='loop'?(_0x278694[_0x5df41c(0x1ae)](new Option(_0x5df41c(0x173),'outer')),_0x278694[_0x5df41c(0x1ae)](new Option(_0x5df41c(0x161),'inner'))):(_0x278694[_0x5df41c(0x1ae)](new Option('上行\x20(Up)','up')),_0x278694['add'](new Option(_0x5df41c(0x1b3),_0x5df41c(0x1e6)))),_0x278694[_0x5df41c(0x18f)]=appData[_0x5df41c(0x24b)][_0x5df41c(0x238)];}function saveCfg(){const _0x47349e=_0x42edf9;appData[_0x47349e(0x24b)]['lineName']=document[_0x47349e(0x222)](_0x47349e(0x15b))[_0x47349e(0x18f)],appData['meta'][_0x47349e(0x21d)]=document[_0x47349e(0x222)]('cfg-color')[_0x47349e(0x18f)],appData['meta'][_0x47349e(0x221)]=document['getElementById'](_0x47349e(0x1c7))[_0x47349e(0x18f)],appData[_0x47349e(0x24b)]['dirType']=document[_0x47349e(0x222)]('cfg-dir')[_0x47349e(0x18f)],updUI(),sync();}function renderAdmin(){const _0x222bae=_0x42edf9,_0x5f1289=appData[_0x222bae(0x163)][rt[_0x222bae(0x235)]];document[_0x222bae(0x222)](_0x222bae(0x1da))['innerText']=_0x5f1289?_0x5f1289['name']:_0x222bae(0x1cf);const _0x1c9606=document[_0x222bae(0x222)](_0x222bae(0x228));_0x1c9606[_0x222bae(0x1b0)]=rt[_0x222bae(0x20a)]===0x0?'进站':'出站',_0x1c9606[_0x222bae(0x1f9)][_0x222bae(0x17a)]=rt[_0x222bae(0x20a)]===0x0?_0x222bae(0x1b4):_0x222bae(0x1d9);const _0x5120f8=document[_0x222bae(0x222)](_0x222bae(0x1ed));_0x5120f8[_0x222bae(0x22a)]='',appData[_0x222bae(0x163)][_0x222bae(0x1e0)]((_0x174bc5,_0x2d3948)=>{const _0x4421e4=_0x222bae,_0x54d9e5=document['createElement'](_0x4421e4(0x232));_0x54d9e5[_0x4421e4(0x1b9)]=_0x4421e4(0x18e)+(_0x2d3948===rt[_0x4421e4(0x235)]?'active':''),_0x54d9e5[_0x4421e4(0x22a)]=_0x4421e4(0x1d4)+_0x2d3948+_0x4421e4(0x1db)+(_0x2d3948+0x1)+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x174bc5[_0x4421e4(0x20e)]+_0x4421e4(0x159)+_0x174bc5['en']+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22item-act\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20b-blue\x22\x20style=\x22padding:4px\x208px;\x20font-size:11px;\x22\x20onclick=\x22loadEdit('+_0x2d3948+_0x4421e4(0x15e)+_0x2d3948+_0x4421e4(0x20f),_0x5120f8[_0x4421e4(0x231)](_0x54d9e5);});}function clearForm(){const _0xe26bd1=_0x42edf9;document[_0xe26bd1(0x222)](_0xe26bd1(0x214))[_0xe26bd1(0x18f)]='',document[_0xe26bd1(0x222)](_0xe26bd1(0x223))[_0xe26bd1(0x18f)]='',document[_0xe26bd1(0x222)](_0xe26bd1(0x19e))[_0xe26bd1(0x22a)]='',document[_0xe26bd1(0x222)](_0xe26bd1(0x1f8))[_0xe26bd1(0x18f)]='-1',document[_0xe26bd1(0x222)](_0xe26bd1(0x21a))['innerText']=_0xe26bd1(0x1e5);}function addXfer(_0x1e077c='',_0x5ab3ab=_0x42edf9(0x1d3)){const _0x49cb8d=_0x42edf9;document['getElementById'](_0x49cb8d(0x19e))[_0x49cb8d(0x1c1)](_0x49cb8d(0x16b),_0x49cb8d(0x24a)+_0x1e077c+_0x49cb8d(0x1d8)+_0x5ab3ab+_0x49cb8d(0x174));}function loadEdit(_0x1fda26){const _0x43cc8c=_0x42edf9,_0x225228=appData['stations'][_0x1fda26];document[_0x43cc8c(0x222)](_0x43cc8c(0x214))[_0x43cc8c(0x18f)]=_0x225228[_0x43cc8c(0x20e)],document[_0x43cc8c(0x222)](_0x43cc8c(0x223))[_0x43cc8c(0x18f)]=_0x225228['en'];const _0x1952a6=document[_0x43cc8c(0x222)](_0x43cc8c(0x19e));_0x1952a6['innerHTML']='';if(_0x225228[_0x43cc8c(0x167)])_0x225228['xfer']['forEach'](_0x24dadb=>addXfer(_0x24dadb[_0x43cc8c(0x153)],_0x24dadb[_0x43cc8c(0x1e3)]));document[_0x43cc8c(0x222)]('ed-idx')[_0x43cc8c(0x18f)]=_0x1fda26,document[_0x43cc8c(0x222)]('btn-txt')['innerText']=_0x43cc8c(0x181);}function saveSt(){const _0x920114=_0x42edf9,_0x5abf2b=document[_0x920114(0x222)](_0x920114(0x214))[_0x920114(0x18f)];if(!_0x5abf2b)return;const _0x334000=[];document[_0x920114(0x178)](_0x920114(0x22f))[_0x920114(0x1e0)](_0x126ab6=>{const _0x2a39d1=_0x920114,_0x9cc34d=_0x126ab6[_0x2a39d1(0x1b1)](_0x2a39d1(0x158))['value'],_0x1abce7=_0x126ab6[_0x2a39d1(0x1b1)](_0x2a39d1(0x188))['value'];if(_0x9cc34d)_0x334000[_0x2a39d1(0x1ad)]({'line':_0x9cc34d,'color':_0x1abce7});});const _0x3feeea={'name':_0x5abf2b,'en':document[_0x920114(0x222)](_0x920114(0x223))['value']||_0x5abf2b,'xfer':_0x334000},_0x3ec7e5=parseInt(document[_0x920114(0x222)](_0x920114(0x1f8))[_0x920114(0x18f)]);if(_0x3ec7e5===-0x1)appData[_0x920114(0x163)][_0x920114(0x1ad)](_0x3feeea);else appData['stations'][_0x3ec7e5]=_0x3feeea;clearForm(),sync();}function del(_0x11b67c){const _0x288c85=_0x42edf9;if(appData[_0x288c85(0x163)]['length']<=0x1)return alert(_0x288c85(0x177));if(confirm('确定删除该站点吗？')){appData['stations'][_0x288c85(0x1a1)](_0x11b67c,0x1);if(rt[_0x288c85(0x235)]>=appData[_0x288c85(0x163)][_0x288c85(0x244)])rt[_0x288c85(0x235)]=0x0;sync();}}function startRec(){const _0x197358=_0x42edf9;if(isRec)return;var _0x45434f;if((_0x45434f=document['getElementById'](_0x197358(0x1c6))[_0x197358(0x18f)])<=0x0||_0x45434f%0x1!=0x0)return alert(_0x197358(0x242));isRec=!![];const _0x234dbb=(parseFloat(document[_0x197358(0x222)]('rec-bps')[_0x197358(0x18f)])||0x8)*0xf4240,_0x2b146a=parseFloat(_0x45434f)*0x3e8,_0x2336be=Date[_0x197358(0x199)]();let _0x49134c=0x0;const _0x14f29a=()=>{const _0x24ad2a=_0x197358;if(!isRec)return;_0x49134c++;const _0x108943=_0x2336be+_0x49134c*_0x2b146a-Date['now']();setTimeout(_0x14f29a,Math[_0x24ad2a(0x20b)](0x0,_0x108943));};_0x14f29a(),isRec=!![],document[_0x197358(0x222)]('rec-mask')[_0x197358(0x1f9)][_0x197358(0x191)]='flex',bc['postMessage']({'t':_0x197358(0x240),'a':_0x197358(0x1d7),'b':_0x234dbb}),recTimer=setInterval(()=>{if(!isRec)return clearInterval(recTimer);next();},_0x2b146a);}function stopRec(){const _0x18f8e8=_0x42edf9;isRec=![],clearInterval(recTimer),document[_0x18f8e8(0x222)]('rec-mask')[_0x18f8e8(0x1f9)][_0x18f8e8(0x191)]=_0x18f8e8(0x1b6),bc[_0x18f8e8(0x220)]({'t':_0x18f8e8(0x240),'a':_0x18f8e8(0x22c)});}function renderDisp(){const _0x860707=_0x42edf9,_0x121307='内部测试\x20BUILD\x202025';let _0x525bca=document['getElementById'](_0x860707(0x21f));if(!_0x525bca){_0x525bca=document[_0x860707(0x16f)](_0x860707(0x232)),_0x525bca['id']=_0x860707(0x21f);const _0xb79e9e=document[_0x860707(0x1b1)](_0x860707(0x1f2));if(_0xb79e9e)_0xb79e9e[_0x860707(0x231)](_0x525bca);}if(_0x525bca)_0x525bca[_0x860707(0x1b0)]=_0x121307;if(!appData||!appData[_0x860707(0x163)][_0x860707(0x244)])return;const _0x575502=appData[_0x860707(0x24b)],_0x945943=appData[_0x860707(0x163)];document[_0x860707(0x245)][_0x860707(0x1f9)][_0x860707(0x1fe)](_0x860707(0x1dd),_0x575502[_0x860707(0x21d)]),document[_0x860707(0x222)](_0x860707(0x1ef))[_0x860707(0x1b0)]=_0x575502[_0x860707(0x217)];let _0x1aa301;const _0x158ef2=_0x945943[_0x860707(0x244)]-0x1;if(_0x575502[_0x860707(0x221)]===_0x860707(0x16d)){const _0x2153be={'outer':[_0x860707(0x1cb),_0x860707(0x241)],'inner':['内环方向',_0x860707(0x243)]},_0x1b5cdf=_0x2153be[_0x575502[_0x860707(0x238)]];document[_0x860707(0x222)](_0x860707(0x1dc))[_0x860707(0x1b0)]=_0x1b5cdf[0x0],document[_0x860707(0x222)](_0x860707(0x18d))[_0x860707(0x1b0)]=_0x1b5cdf[0x1];}else{if(_0x575502[_0x860707(0x238)]==='up')_0x1aa301=_0x945943[_0x158ef2];else _0x1aa301=_0x945943[0x0];document[_0x860707(0x222)](_0x860707(0x1dc))[_0x860707(0x1b0)]='开往\x20'+_0x1aa301[_0x860707(0x20e)],document[_0x860707(0x222)](_0x860707(0x18d))[_0x860707(0x1b0)]=_0x860707(0x1d5)+_0x1aa301['en'];}const _0x582c73=rt['state']===0x0,_0x44b76e=document[_0x860707(0x222)](_0x860707(0x21c)),_0x807f23=document['getElementById'](_0x860707(0x234)),_0x566720=document[_0x860707(0x222)](_0x860707(0x19a)),_0x18f16a=document[_0x860707(0x222)]('d-st-en');_0x582c73?(_0x44b76e[_0x860707(0x1b0)]='到达站',_0x807f23['innerText']='Arriving',_0x566720['classList'][_0x860707(0x1ae)](_0x860707(0x17b)),_0x18f16a['classList'][_0x860707(0x1ae)]('blink')):(_0x44b76e[_0x860707(0x1b0)]=_0x860707(0x1a5),_0x807f23[_0x860707(0x1b0)]=_0x860707(0x1fb),_0x566720['classList'][_0x860707(0x219)](_0x860707(0x17b)),_0x18f16a[_0x860707(0x23e)][_0x860707(0x219)](_0x860707(0x17b)));let _0x341f7b=rt['idx'];if(!_0x582c73){if(_0x575502[_0x860707(0x221)]==='loop'){if(_0x575502[_0x860707(0x238)]==='outer')_0x341f7b=(rt[_0x860707(0x235)]+0x1)%_0x945943[_0x860707(0x244)];else _0x341f7b=(rt[_0x860707(0x235)]-0x1+_0x945943[_0x860707(0x244)])%_0x945943['length'];}else{if(_0x575502[_0x860707(0x238)]==='up')_0x341f7b=Math[_0x860707(0x207)](rt[_0x860707(0x235)]+0x1,_0x945943[_0x860707(0x244)]-0x1);else _0x341f7b=Math[_0x860707(0x20b)](rt[_0x860707(0x235)]-0x1,0x0);}}const _0x3dfd74=_0x945943[_0x341f7b];_0x566720[_0x860707(0x1b0)]=_0x3dfd74[_0x860707(0x20e)],_0x18f16a[_0x860707(0x1b0)]=_0x3dfd74['en'];const _0x3e96f7=document['getElementById']('d-xfer-box');_0x3e96f7[_0x860707(0x22a)]='';if(_0x3dfd74['xfer'])_0x3dfd74[_0x860707(0x167)]['forEach'](_0x3e6ec6=>{const _0x4fff23=_0x860707;_0x3e96f7[_0x4fff23(0x1c1)]('beforeend',_0x4fff23(0x1e8)+_0x3e6ec6['color']+'\x22>'+_0x3e6ec6['line']+'</span>');});const _0x245680=document['getElementById'](_0x860707(0x17d));_0x245680[_0x860707(0x22a)]='';if(_0x575502[_0x860707(0x221)]===_0x860707(0x249))drawLinear(_0x245680,_0x945943,_0x575502);else drawRing(_0x245680,_0x945943,_0x575502);}function mkNode(_0x234bcb,_0x59b832,_0x56402d){const _0x133eff=_0x42edf9,_0x5e5091=document[_0x133eff(0x16f)](_0x133eff(0x232));_0x5e5091[_0x133eff(0x1b9)]=_0x133eff(0x15f);let _0x152e12=![],_0x598d4f=![],_0x51d37b=![];const _0xa1f5eb=rt['idx'],_0x44e787=appData[_0x133eff(0x163)],_0x2ce8c0=appData['meta'];let _0x6dd33b=_0xa1f5eb;if(rt['state']===0x1){if(_0x2ce8c0[_0x133eff(0x221)]==='loop'){if(_0x2ce8c0[_0x133eff(0x238)]===_0x133eff(0x1e9))_0x6dd33b=_0xa1f5eb+0x1;else _0x6dd33b=_0xa1f5eb-0x1;if(_0x6dd33b>=_0x44e787['length'])_0x6dd33b=0x0;if(_0x6dd33b<0x0)_0x6dd33b=_0x44e787[_0x133eff(0x244)]-0x1;}else{if(_0x2ce8c0[_0x133eff(0x238)]==='up')_0x6dd33b=Math[_0x133eff(0x207)](_0xa1f5eb+0x1,_0x44e787[_0x133eff(0x244)]-0x1);else _0x6dd33b=Math['max'](_0xa1f5eb-0x1,0x0);}}if(_0x59b832===_0x6dd33b)_0x51d37b=!![];if(_0x56402d===_0x133eff(0x16d)){if(_0x59b832===_0xa1f5eb&&rt['state']===0x0)_0x598d4f=!![];}else{const _0x5d8642=appData[_0x133eff(0x24b)][_0x133eff(0x238)];if(_0x5d8642==='up'){if(_0x59b832<_0xa1f5eb)_0x152e12=!![];if(_0x59b832===_0xa1f5eb)rt['state']===0x0?_0x598d4f=!![]:_0x152e12=!![];}else{if(_0x59b832>_0xa1f5eb)_0x152e12=!![];if(_0x59b832===_0xa1f5eb)rt[_0x133eff(0x20a)]===0x0?_0x598d4f=!![]:_0x152e12=!![];}}if(_0x152e12)_0x5e5091['classList'][_0x133eff(0x1ae)](_0x133eff(0x23d));if(_0x598d4f)_0x5e5091['classList'][_0x133eff(0x1ae)](_0x133eff(0x1bb));if(_0x51d37b)_0x5e5091[_0x133eff(0x23e)][_0x133eff(0x1ae)](_0x133eff(0x15c));let _0x1f6905='';if(_0x234bcb[_0x133eff(0x167)])_0x234bcb[_0x133eff(0x167)][_0x133eff(0x1e0)](_0x82fdf0=>_0x1f6905+=_0x133eff(0x1ff)+_0x82fdf0['color']+'\x22>'+_0x82fdf0[_0x133eff(0x153)]+_0x133eff(0x1e1));return _0x5e5091['innerHTML']=_0x133eff(0x1c0)+_0x234bcb[_0x133eff(0x20e)]+_0x133eff(0x15a)+_0x234bcb['en']+_0x133eff(0x237)+_0x1f6905+_0x133eff(0x1e7),_0x5e5091;}function drawLinear(_0x31f446,_0x5a74cf,_0x134054){const _0x342682=_0x42edf9;_0x31f446[_0x342682(0x1b9)]=_0x342682(0x198);const _0x483fb0=document[_0x342682(0x16f)](_0x342682(0x232));_0x483fb0['className']=_0x342682(0x170),_0x483fb0[_0x342682(0x22a)]='<div\x20class=\x22l-bg\x22></div>';const _0x14f2fa=document[_0x342682(0x16f)](_0x342682(0x232));_0x14f2fa['className']=_0x342682(0x233);let _0x2ce254=rt[_0x342682(0x235)];if(rt[_0x342682(0x20a)]===0x1){if(_0x134054['dirType']==='up')_0x2ce254+=0.5;else _0x2ce254-=0.5;}const _0x549fae=0xc8;_0x134054[_0x342682(0x238)]===_0x342682(0x1e6)?(_0x14f2fa[_0x342682(0x1f9)]['left']='auto',_0x14f2fa[_0x342682(0x1f9)][_0x342682(0x1bd)]='0',_0x14f2fa[_0x342682(0x1f9)][_0x342682(0x23f)]=(_0x5a74cf[_0x342682(0x244)]-0x1-_0x2ce254)*_0x549fae+0x64+'px'):_0x14f2fa[_0x342682(0x1f9)][_0x342682(0x23f)]=_0x2ce254*_0x549fae+0x64+'px',_0x483fb0['appendChild'](_0x14f2fa),_0x5a74cf[_0x342682(0x1e0)]((_0x49db46,_0x3432cb)=>{const _0x3cb5e5=_0x342682,_0x1c5d9a=mkNode(_0x49db46,_0x3432cb,'linear');_0x1c5d9a[_0x3cb5e5(0x23e)][_0x3cb5e5(0x1ae)](_0x3cb5e5(0x1a0)),_0x483fb0[_0x3cb5e5(0x231)](_0x1c5d9a);}),_0x31f446[_0x342682(0x231)](_0x483fb0),setTimeout(()=>_0x31f446['scrollTo']({'left':rt[_0x342682(0x235)]*_0x549fae-0x780/0x2+0x64,'behavior':'smooth'}),0x32);}function drawRing(_0x248bf1,_0x301002,_0x2e6847){const _0x4926d4=_0x42edf9;_0x248bf1[_0x4926d4(0x1b9)]=_0x4926d4(0x1fc);const _0x3fd027=0x780,_0x32bf4b=0x168,_0x5408ce=0x50,_0x3bb92d=0x578,_0x12b254=(_0x3fd027-_0x3bb92d)/0x2+_0x5408ce,_0x1d0da4=(_0x3fd027+_0x3bb92d)/0x2-_0x5408ce,_0xd5cb2c='M\x20'+_0x12b254+'\x20'+(_0x32bf4b/0x2-_0x5408ce)+_0x4926d4(0x1f3)+_0x1d0da4+'\x20'+(_0x32bf4b/0x2-_0x5408ce)+_0x4926d4(0x23a)+_0x5408ce+'\x20'+_0x5408ce+_0x4926d4(0x225)+_0x1d0da4+'\x20'+(_0x32bf4b/0x2+_0x5408ce)+_0x4926d4(0x1f3)+_0x12b254+'\x20'+(_0x32bf4b/0x2+_0x5408ce)+'\x20A\x20'+_0x5408ce+'\x20'+_0x5408ce+_0x4926d4(0x225)+_0x12b254+'\x20'+(_0x32bf4b/0x2-_0x5408ce)+'\x20Z',_0x4091ae=document[_0x4926d4(0x189)](_0x4926d4(0x1fd),'svg');_0x4091ae[_0x4926d4(0x1d1)](_0x4926d4(0x184),_0x4926d4(0x1eb)),_0x4091ae[_0x4926d4(0x1d1)](_0x4926d4(0x15d),'0\x200\x20'+_0x3fd027+'\x20'+_0x32bf4b);const _0x1ffd75=document['createElementNS'](_0x4926d4(0x1fd),_0x4926d4(0x175));_0x1ffd75[_0x4926d4(0x1d1)]('d',_0xd5cb2c),_0x1ffd75['setAttribute']('fill',_0x4926d4(0x1b6)),_0x1ffd75['setAttribute'](_0x4926d4(0x22d),_0x4926d4(0x185)),_0x1ffd75[_0x4926d4(0x1d1)]('stroke-width','16');const _0x5e834a=document[_0x4926d4(0x189)](_0x4926d4(0x1fd),_0x4926d4(0x175));_0x5e834a[_0x4926d4(0x1d1)]('d',_0xd5cb2c),_0x5e834a[_0x4926d4(0x1d1)](_0x4926d4(0x157),_0x4926d4(0x1b6)),_0x5e834a[_0x4926d4(0x1d1)](_0x4926d4(0x22d),'#fff'),_0x5e834a[_0x4926d4(0x1d1)](_0x4926d4(0x169),'16'),_0x5e834a[_0x4926d4(0x1f9)][_0x4926d4(0x1a2)]='drop-shadow(0\x200\x205px\x20rgba(255,255,255,0.6))';const _0x48843f=document[_0x4926d4(0x189)]('http://www.w3.org/2000/svg',_0x4926d4(0x175));_0x48843f[_0x4926d4(0x1d1)]('d',_0xd5cb2c),_0x48843f[_0x4926d4(0x1d1)](_0x4926d4(0x157),_0x4926d4(0x1b6)),_0x4091ae[_0x4926d4(0x17e)](_0x1ffd75,_0x5e834a,_0x48843f),_0x248bf1[_0x4926d4(0x231)](_0x4091ae);const _0x4a78d4=_0x48843f[_0x4926d4(0x18c)](),_0x599c9a=_0x301002[_0x4926d4(0x244)];let _0x481fc8=rt[_0x4926d4(0x235)];if(rt[_0x4926d4(0x20a)]===0x1){if(_0x2e6847[_0x4926d4(0x238)]==='outer')_0x481fc8+=0.5;else _0x481fc8-=0.5;}let _0x259ecf=_0x481fc8%_0x599c9a;if(_0x259ecf<0x0)_0x259ecf+=_0x599c9a;const _0x31233d=_0x4a78d4/_0x599c9a;if(_0x2e6847[_0x4926d4(0x238)]===_0x4926d4(0x1e9)){const _0x2c3e26=_0x259ecf*_0x31233d;_0x5e834a['style'][_0x4926d4(0x21b)]=_0x2c3e26+'\x20'+_0x4a78d4,_0x5e834a[_0x4926d4(0x1f9)][_0x4926d4(0x171)]=0x0;}else{const _0x23e88e=(_0x599c9a-_0x259ecf)*_0x31233d,_0x2994e1=_0x259ecf*_0x31233d;_0x5e834a['style'][_0x4926d4(0x21b)]=_0x23e88e+'\x20'+_0x4a78d4,_0x5e834a[_0x4926d4(0x1f9)][_0x4926d4(0x171)]=-_0x2994e1;}_0x5e834a[_0x4926d4(0x1f9)][_0x4926d4(0x22e)]='stroke-dasharray\x200.5s\x20linear,\x20stroke-dashoffset\x200.5s\x20linear',_0x301002[_0x4926d4(0x1e0)]((_0x15e60f,_0x19598a)=>{const _0x3544b2=_0x4926d4,_0x3218ee=mkNode(_0x15e60f,_0x19598a,_0x3544b2(0x16d)),_0x365321=_0x48843f['getPointAtLength'](_0x19598a/_0x599c9a*_0x4a78d4);_0x3218ee['style'][_0x3544b2(0x1c8)]=_0x365321['x']+'px',_0x3218ee['style']['top']=_0x365321['y']+'px';const _0x12aa10=_0x3218ee[_0x3544b2(0x1b1)](_0x3544b2(0x246));_0x365321['y']<_0x32bf4b/0x2?(_0x12aa10[_0x3544b2(0x1f9)][_0x3544b2(0x16e)]=_0x3544b2(0x218),_0x12aa10[_0x3544b2(0x1f9)][_0x3544b2(0x19f)]='45px'):(_0x12aa10[_0x3544b2(0x1f9)][_0x3544b2(0x16e)]=_0x3544b2(0x208),_0x12aa10[_0x3544b2(0x1f9)]['bottom']=_0x3544b2(0x218)),_0x248bf1[_0x3544b2(0x231)](_0x3218ee);});}async function doRec(_0x26d675){const _0x104b26=_0x42edf9;try{const _0x1cd369=await navigator[_0x104b26(0x1fa)][_0x104b26(0x1c2)]({'video':{'displaySurface':_0x104b26(0x180),'frameRate':0x3c},'audio':![]});document[_0x104b26(0x222)](_0x104b26(0x1f6))[_0x104b26(0x1f9)][_0x104b26(0x191)]='block';const _0x425674={'mimeType':_0x104b26(0x204),'videoBitsPerSecond':_0x26d675};if(!MediaRecorder[_0x104b26(0x176)](_0x425674[_0x104b26(0x165)]))_0x425674['mimeType']='video/webm';recorder=new MediaRecorder(_0x1cd369,_0x425674),chunks=[],recorder[_0x104b26(0x1a6)]=_0xebe648=>{const _0xc3ddf9=_0x104b26;if(_0xebe648['data']['size']>0x0)chunks[_0xc3ddf9(0x1ad)](_0xebe648[_0xc3ddf9(0x183)]);},recorder[_0x104b26(0x1aa)]=()=>{const _0x3c6726=_0x104b26,_0x3919a3=new Blob(chunks,{'type':_0x3c6726(0x1a9)}),_0x1931e0=URL[_0x3c6726(0x155)](_0x3919a3),_0x243faa=document[_0x3c6726(0x16f)]('a');_0x243faa['href']=_0x1931e0,_0x243faa['download']=_0x3c6726(0x17f)+Date[_0x3c6726(0x199)]()+_0x3c6726(0x1df),_0x243faa[_0x3c6726(0x1be)](),document[_0x3c6726(0x222)](_0x3c6726(0x1f6))[_0x3c6726(0x1f9)]['display']=_0x3c6726(0x1b6);},recorder[_0x104b26(0x1d7)]();}catch(_0x1a5e83){console[_0x104b26(0x1a7)](_0x1a5e83),alert('录制启动失败，请检查浏览器权限'),bc[_0x104b26(0x220)]({'t':_0x104b26(0x187)});}}function stopRecFile(){const _0x140d1d=_0x42edf9;if(recorder&&recorder[_0x140d1d(0x20a)]!==_0x140d1d(0x164))recorder[_0x140d1d(0x22c)]();}function exportData(){const _0x28498c=_0x42edf9,_0x3d1f97=new Blob([JSON[_0x28498c(0x1c4)](appData)],{'type':_0x28498c(0x168)}),_0xce8368=document['createElement']('a');_0xce8368['href']=URL['createObjectURL'](_0x3d1f97),_0xce8368[_0x28498c(0x1b5)]=_0x28498c(0x200),_0xce8368[_0x28498c(0x1be)]();}function importData(_0x5c367c){const _0x1fe387=_0x42edf9,_0x44c069=_0x5c367c[_0x1fe387(0x1d2)][0x0];if(!_0x44c069)return;const _0x518088=new FileReader();_0x518088[_0x1fe387(0x1ce)]=_0x48f7ac=>{const _0x2865b5=_0x1fe387;try{const _0x3132a7=JSON['parse'](_0x48f7ac[_0x2865b5(0x15c)][_0x2865b5(0x1d6)]);_0x3132a7[_0x2865b5(0x163)]&&(appData=_0x3132a7,rt={'idx':0x0,'state':0x0},sync());}catch(_0x11aaca){alert(_0x2865b5(0x1d0));}},_0x518088['readAsText'](_0x44c069);}function resetData(){const _0x49afdb=_0x42edf9;confirm('【警告】这将清空所有线路数据并恢复出厂设置，确定吗？')&&(localStorage[_0x49afdb(0x212)]('pids_global_store_v1'),location[_0x49afdb(0x201)]());}function openWin(){const _0x196a90=_0x42edf9;window['open'](location[_0x196a90(0x1f1)]+_0x196a90(0x20c),_0x196a90(0x166),'width=1280,height=720');}
    </script>
</body>
</html>
