# Display-3 å‡ºç«™æŒ‡ç¤ºå±ä½¿ç”¨æŒ‡å—

## æ¦‚è¿°

Display-3 å·²å®Œå…¨é‡æ–°è®¾è®¡ä¸ºåŒ—äº¬åœ°é“å‡ºç«™æŒ‡ç¤ºå± (Exit Indicator Screen)ï¼Œåˆ†è¾¨ç‡ **1900Ã—600** LCDå±å¹•ã€‚

è¿™æ˜¯ä¸€ä¸ªä¸“ä¸šçš„åœ°é“å‡ºç«™æŒ‡å¼•é¡µé¢ï¼ŒåŒ…å«ï¼š
- çº¿è·¯å·æ˜¾ç¤º + æ—¶é—´/æ—¥æœŸ
- å¾ªç¯æ–¹å‘æ ‡ç­¾ï¼ˆå†…å¾ª/å¤–å¾ªï¼‰
- ä¸‹ä¸€ç«™ä¿¡æ¯ï¼ˆä¸­è‹±æ–‡ï¼‰
- å¯æ¢ä¹˜çº¿è·¯åˆ—è¡¨
- ç«™ç‚¹åœ°å›¾åˆ†å¸ƒï¼ˆè“è‰²æ¸å˜è®¾è®¡ï¼‰
- å‡ºé—¨æŒ‡å¼•ï¼ˆå·¦/å³/æœ¬ä¾§å¼€é—¨ï¼‰

---

## é¡µé¢è®¾è®¡è¯´æ˜

### ğŸ¨ å¸ƒå±€ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Display-3 å‡ºç«™é¡µé¢ (1900Ã—600)        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ã€å·¦ä¾§ 40%ã€‘   â”‚      ã€å³ä¾§ 60%ã€‘è“è‰²æ¸å˜èƒŒæ™¯       â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ â”Œâ”€ çº¿è·¯ä¿¡æ¯â”€â”€â”  â”‚  â—¯ è²èŠ±æ¡¥                          â”‚
â”‚ â”‚ åŒ—äº¬åœ°é“ 10â”‚  â”‚ â—‰ å…¬ä¸»å¡ â† å½“å‰ç«™ï¼ˆé«˜äº®æ˜¾ç¤ºï¼‰    â”‚
â”‚ â”‚ Line 10   â”‚  â”‚  â—¯ è¥¿é’“é±¼å°                        â”‚
â”‚ â””â”€â”€â”€10:21â”€â”€â”€â”˜  â”‚                                   â”‚
â”‚  2025-05-21    â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—                 â”‚
â”‚                â”‚  â•‘  æœ¬ä¾§å¼€é—¨      â•‘  â† å‡ºé—¨æŒ‡å¼•     â”‚
â”‚ â”Œâ”€ æ ‡ç­¾ â”€â”€â”   â”‚  â•‘  Please exit   â•‘     + å·¦å³ç®­å¤´   â”‚
â”‚ â”‚ å†…ç¯    â”‚   â”‚  â•‘  from this     â•‘                â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â•‘  door          â•‘                â”‚
â”‚                â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                â”‚
â”‚ ä¸‹ä¸€ç«™         â”‚                                   â”‚
â”‚ Next Station   â”‚                                   â”‚
â”‚ å…¬ä¸»å¡         â”‚                                   â”‚
â”‚ Gongzhufen    â”‚                                   â”‚
â”‚                â”‚                                   â”‚
â”‚ å¯æ¢ä¹˜         â”‚                                   â”‚
â”‚ Transfer to    â”‚                                   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”        â”‚                                   â”‚
â”‚ â”‚1å·çº¿â”‚        â”‚                                   â”‚
â”‚ â””â”€â”€â”€â”€â”˜        â”‚                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ¯ è®¾è®¡ç‰¹ç‚¹

| åŒºåŸŸ | ç‰¹ç‚¹ | é…è‰² |
|------|------|------|
| **å·¦ä¾§ä¿¡æ¯é¢æ¿** | æ·±è‰²èƒŒæ™¯ï¼Œæ˜¾ç¤ºå…³é”®ä¿¡æ¯ | é»‘è‰²èƒŒæ™¯ + è“è‰²é«˜äº® |
| **å¾ªç¯æ ‡ç­¾** | çº¢è‰²æ¸å˜ï¼Œæ˜¾ç¤ºæ–¹å‘ | #ff6b6b â†’ #ff8787 |
| **å³ä¾§åœ°å›¾** | è“è‰²å¼§å½¢è®¾è®¡ï¼Œä¸“ä¸šæ„Ÿå¼º | #0099ff â†’ #00ccff |
| **ç«™ç‚¹æ ‡è®°** | è·¯çº¿åˆ†å¸ƒï¼Œå½“å‰ç«™é«˜äº® | ç™½è‰² + é«˜äº®ç™½è‰² |
| **å‡ºé—¨æŒ‡å¼•** | å³ä¸‹è§’æŒ‰é’®å¼æŒ‡å¼• | ç™½è‰²èƒŒæ™¯ + è“è‰²æŒ‰é’® |

---

## å¿«é€Ÿå¼€å§‹

### æ–¹å¼1ï¸âƒ£: æµè§ˆå™¨é¢„è§ˆï¼ˆæœ€å¿«ï¼‰

ç›´æ¥æ‰“å¼€ `test_exit_indicator.html` åœ¨æµè§ˆå™¨ä¸­é¢„è§ˆæ•ˆæœï¼š

```bash
# Windows
start displays/display-3/test_exit_indicator.html

# Mac
open displays/display-3/test_exit_indicator.html

# Linux
xdg-open displays/display-3/test_exit_indicator.html
```

ç‚¹å‡»å³ä¸Šè§’çš„æŒ‰é’®æµ‹è¯•ï¼š
- **åŒ—äº¬åœ°é“10å·çº¿** - é»˜è®¤ç¤ºä¾‹ï¼ˆæ¨èå…ˆçœ‹ï¼‰
- **åŒ—äº¬åœ°é“2å·çº¿** - æ˜¾ç¤ºå¤šæ¡æ¢ä¹˜çº¿è·¯
- **åŒ—äº¬åœ°é“1å·çº¿** - æ¼”ç¤ºä¸åŒæ–¹å‘å¾ªç¯
- **åŠŸèƒ½æµ‹è¯•æŒ‰é’®** - åˆ‡æ¢æ–¹å‘ã€ä¸Šä¸‹ç«™åˆ‡æ¢

---

## æ•°æ®æ ¼å¼

### å‘é€æ¶ˆæ¯æ ¼å¼

å‘ display-3 å‘é€å‡ºç«™æ•°æ®ï¼Œä½¿ç”¨ä»¥ä¸‹æ¶ˆæ¯æ ¼å¼ï¼š

```javascript
// é€šè¿‡ BroadcastChannel
const bc = new BroadcastChannel('metro_pids_v3');

bc.postMessage({
  t: 'EXIT_DATA',  // æ¶ˆæ¯ç±»å‹ï¼šå›ºå®šä¸º EXIT_DATA
  d: {
    // çº¿è·¯å·
    line: '10',

    // å¾ªç¯æ–¹å‘: 'inner' è¡¨ç¤ºå†…ç¯ï¼Œ'outer' è¡¨ç¤ºå¤–ç¯
    direction: 'inner',

    // ä¸‹ä¸€ç«™ä¿¡æ¯
    nextStation: {
      name: 'å…¬ä¸»å¡',      // ä¸­æ–‡ç«™å
      nameEn: 'Gongzhufen' // è‹±æ–‡ç«™å
    },

    // æ¢ä¹˜çº¿è·¯åˆ—è¡¨ï¼ˆæœ€å¤šæ˜¾ç¤º3æ¡ï¼‰
    transfers: [
      '1å·çº¿',
      'å…¶ä»–çº¿è·¯'
    ],

    // ç«™ç‚¹åˆ—è¡¨ï¼ˆæ˜¾ç¤ºåœ¨å³ä¾§åœ°å›¾ä¸Šï¼Œæœ€å¤š3ä¸ªï¼‰
    stations: [
      { name: 'è²èŠ±æ¡¥', nameEn: 'Lianhuaqiao' },
      { name: 'å…¬ä¸»å¡', nameEn: 'Gongzhufen' },
      { name: 'è¥¿é’“é±¼å°', nameEn: 'Xidiayoutai' }
    ],

    // å½“å‰ç«™åœ¨ stations æ•°ç»„ä¸­çš„ç´¢å¼•
    currentStationIndex: 1,

    // å‡ºé—¨æŒ‡å¼•ä¿¡æ¯
    exitGuide: {
      cn: 'æœ¬ä¾§å¼€é—¨',              // ä¸­æ–‡
      en: 'Please exit from this door' // è‹±æ–‡
    }
  }
});
```

### å®Œæ•´æ•°æ®ç»“æ„è¯´æ˜

```typescript
type ExitIndicatorData = {
  t: 'EXIT_DATA';
  d: {
    line: string;                    // '10', '2', '1' ç­‰
    direction: 'inner' | 'outer';    // å¾ªç¯æ–¹å‘
    nextStation: {
      name: string;                  // ä¸‹ä¸€ç«™ä¸­æ–‡å
      nameEn: string;                // ä¸‹ä¸€ç«™è‹±æ–‡å
    };
    transfers: string[];             // æ¢ä¹˜çº¿è·¯åˆ—è¡¨
    stations: Array<{
      name: string;                  // ç«™åä¸­æ–‡
      nameEn: string;                // ç«™åè‹±æ–‡
    }>;
    currentStationIndex: number;     // å½“å‰ç«™ç´¢å¼•
    exitGuide: {
      cn: string;                    // ä¸­æ–‡æŒ‡å¼•
      en: string;                    // è‹±æ–‡æŒ‡å¼•
    };
  };
};
```

---

## åœ¨ Electron ä¸­ä½¿ç”¨

### 1. ä» main.js å‘é€æ•°æ®

```javascript
// åœ¨ main.js ä¸­

const { ipcMain, BroadcastChannel } = require('electron');

// å‡è®¾ display3Window æ˜¯ display-3 çš„çª—å£å¯¹è±¡

// æ–¹å¼1: ä½¿ç”¨ IPC ä»ä¸»è¿›ç¨‹å‘é€
ipcMain.handle('send-exit-data', (event, data) => {
  // data æ ¼å¼è§ä¸Šæ–¹
  display3Window.webContents.send('exit-data:update', data);
});

// æ–¹å¼2: é€šè¿‡ BroadcastChannel
function sendExitDataToDisplay3(exitData) {
  const bc = new BroadcastChannel('metro_pids_v3');
  bc.postMessage({
    t: 'EXIT_DATA',
    d: exitData
  });
  bc.close();
}

// æ–¹å¼3: é€šè¿‡ window.postMessage
display3Window.webContents.send('display:message', {
  t: 'EXIT_DATA',
  d: exitData
});
```

### 2. ä»åº”ç”¨æ•°æ®æºå‘é€

```javascript
// åœ¨æ•°æ®ç®¡ç†æ¨¡å—ä¸­

const exitData = {
  line: '10',
  direction: 'inner',
  nextStation: {
    name: getCurrentNextStation(),
    nameEn: getCurrentNextStationEN()
  },
  transfers: getAvailableTransfers(),
  stations: getNearbyStations(),
  currentStationIndex: getCurrentStationIndex(),
  exitGuide: {
    cn: getExitGuideCN(),
    en: getExitGuideEN()
  }
};

// å‘é€æ–¹å¼ï¼ˆé€‰ä¸€ä¸ªï¼‰
sendExitDataToDisplay3(exitData);
```

---

## å‡ºé—¨æŒ‡å¼•å¯¹ç…§è¡¨

### å¸¸ç”¨å‡ºé—¨æŒ‡å¼•æ–‡æœ¬

| ä¸­æ–‡ | è‹±æ–‡ | ä½¿ç”¨åœºæ™¯ |
|------|------|---------|
| `æœ¬ä¾§å¼€é—¨` | `Please exit from this door` | æŒ‡å¼•ä¹˜å®¢ä»è¯¥æ‰¶æ¢¯ä¾§å¼€é—¨ä¸‹è½¦ |
| `å·¦ä¾§å¼€é—¨` | `Left side doors open` | åˆ—è½¦å·¦ä¾§å¼€é—¨ |
| `å³ä¾§å¼€é—¨` | `Right side doors open` | åˆ—è½¦å³ä¾§å¼€é—¨ |
| `ä¸¤ä¾§å¼€é—¨` | `Both sides doors open` | åˆ—è½¦ä¸¤ä¾§å¼€é—¨ |
| `å‰æ–¹å¼€é—¨` | `Doors open ahead` | å‰è½¦é—¨å¼€é—¨ |
| `åæ–¹å¼€é—¨` | `Doors open behind` | åè½¦é—¨å¼€é—¨ |

---

## å®æ—¶æ•°æ®å¿«ç…§

Display-3 ä¼šè‡ªåŠ¨å°†æ”¶åˆ°çš„æœ€æ–°æ•°æ®ä¿å­˜åˆ° `localStorage`ï¼š

```javascript
// localStorage ä¸­çš„ key
'metro_pids_display_snapshot_d3'

// å½“é¡µé¢åˆ·æ–°æ—¶ï¼Œä¼šä»æ­¤å¿«ç…§æ¢å¤æ˜¾ç¤º
// è¿™æ ·å¯ä»¥ç¡®ä¿é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºä¸Šä¸€æ¬¡çš„æ­£ç¡®ä¿¡æ¯
```

---

## é…è‰²æ–¹æ¡ˆé€ŸæŸ¥

### ä¸»è¦é¢œè‰²

```css
/* æ–‡å­— */
--primary-blue: #0088ff;    /* ä¸»è“è‰² */
--light-blue: #00bfff;      /* æµ…è“è‰² */
--text-white: #ffffff;      /* ç™½è‰²æ–‡å­— */
--text-gray: #888888;       /* ç°è‰²æ–‡å­— */

/* èƒŒæ™¯ */
--bg-black: #000000;        /* çº¯é»‘èƒŒæ™¯ */
--bg-dark: #1a1a1a;         /* æ·±ç°èƒŒæ™¯ */
--bg-darker: #0a0a0a;       /* æ›´æ·±ç° */

/* å¼ºè°ƒ */
--accent-red: #ff3333;      /* å¼ºè°ƒçº¢ */
--transfer-red: #ff5555;    /* æ¢ä¹˜çº¿è·¯çº¢ */
--gradient-blue: linear-gradient(135deg, #0099ff 0%, #00ccff 100%); /* è“è‰²æ¸å˜ */

/* é˜´å½± */
--shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.2);
--shadow-md: 0 4px 12px rgba(0, 0, 0, 0.3);
```

---

## æ–‡ä»¶ç»“æ„

```
displays/display-3/
â”œâ”€â”€ display_window.html           # HTML å…¥å£æ–‡ä»¶
â”œâ”€â”€ display-entry.js             # Vue åº”ç”¨åˆå§‹åŒ–
â”œâ”€â”€ DisplayWindow.vue             # Vue ç»„ä»¶ï¼ˆæ–°å¢å‡ºç«™é¡µé¢è®¾è®¡ï¼‰
â”œâ”€â”€ displayWindowLogic.js         # å‡ºç«™é¡µé¢é€»è¾‘å¤„ç†ï¼ˆå…¨æ–°ç¼–å†™ï¼‰
â”œâ”€â”€ exitDataExample.js            # æ•°æ®æ ¼å¼ç¤ºä¾‹
â”œâ”€â”€ test_exit_indicator.html      # æµè§ˆå™¨æµ‹è¯•é¡µé¢
â””â”€â”€ README.md                     # æœ¬æ–‡æ¡£
```

---

## å¸¸è§é—®é¢˜

### Q: å¦‚ä½•æ”¹å˜å¾ªç¯æ–¹å‘æ ‡ç­¾çš„æ–‡å­—ï¼Ÿ
**A:** ä¿®æ”¹æ•°æ®ä¸­çš„ `direction` å­—æ®µä¸º `'inner'` æˆ– `'outer'`

```javascript
direction: 'inner'  // æ˜¾ç¤º"å†…ç¯"
direction: 'outer'  // æ˜¾ç¤º"å¤–ç¯"
```

### Q: ä¸ºä»€ä¹ˆç«™ç‚¹åˆ—è¡¨åªæ˜¾ç¤º3ä¸ªï¼Ÿ
**A:** è¿™æ˜¯è®¾è®¡é™åˆ¶ï¼Œä¸ºäº†ä¿æŒé¡µé¢å¸ƒå±€æ•´æ´ã€‚å¯ä¿®æ”¹ `displayWindowLogic.js` çš„ `maxStations` å€¼ã€‚

### Q: å¦‚ä½•æ·»åŠ æ›´å¤šæ¢ä¹˜çº¿è·¯ï¼Ÿ
**A:** åœ¨ `transfers` æ•°ç»„ä¸­æ·»åŠ å³å¯ï¼Œä½†æœ€å¤šæ˜¾ç¤º3æ¡ã€‚

```javascript
transfers: ['1å·çº¿', '2å·çº¿', '4å·çº¿']  // æ˜¾ç¤º3æ¡
```

### Q: é¡µé¢åˆ·æ–°åæ•°æ®ä¸¢å¤±æ€ä¹ˆåŠï¼Ÿ
**A:** Display-3 ä¼šè‡ªåŠ¨ä» `localStorage` æ¢å¤ä¸Šæ¬¡çš„æ•°æ®ï¼Œæ— éœ€æ‹…å¿ƒã€‚

### Q: èƒ½å¦ä¿®æ”¹é¢œè‰²ä¸»é¢˜ï¼Ÿ
**A:** å¯ä»¥ã€‚ç¼–è¾‘ `DisplayWindow.vue` çš„ `<style>` éƒ¨åˆ†ï¼Œä¿®æ”¹CSSå˜é‡å³å¯ã€‚

---

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **æ•°æ®æ›´æ–°é¢‘ç‡** - å»ºè®®ä¸è¶…è¿‡ 1 æ¬¡/ç§’
2. **å›¾ç‰‡èµ„æº** - SVG åœ°å›¾å·²ä¼˜åŒ–ï¼Œä¸éœ€è¦é¢å¤–åŠ è½½
3. **å­—ä½“åŠ è½½** - ä½¿ç”¨ç³»ç»Ÿå­—ä½“ï¼Œé¿å… Web å­—ä½“
4. **å†…å­˜ç®¡ç†** - localStorage å¿«ç…§è‡ªåŠ¨é™åˆ¶åˆ°åˆç†å¤§å°

---

## å¼€å‘è€…å¿«é€Ÿå‚è€ƒ

### ä¿®æ”¹æ—¶é—´æ ¼å¼

åœ¨ `displayWindowLogic.js` çš„ `updateTime()` å‡½æ•°ä¸­ï¼š

```javascript
// å½“å‰æ ¼å¼: "HH:MM"
const timeEl = document.getElementById('current-time');
timeEl.textContent = `${hours}:${minutes}`;

// å¯æ”¹ä¸ºå…¶ä»–æ ¼å¼å¦‚ "HH:MM:SS"
```

### æ·»åŠ æ–°çš„å‡ºé—¨æŒ‡å¼•

```javascript
// åœ¨ updateExitGuide() ä¸­ä¿®æ”¹
exitGuide: {
  cn: 'æ‚¨çš„è‡ªå®šä¹‰æ–‡å­—',
  en: 'Your custom text'
}
```

### è°ƒæ•´ç«™ç‚¹æ˜¾ç¤ºæ•°é‡

```javascript
// displayWindowLogic.js ä¸­çš„ `updateStationsList` å‡½æ•°
const maxStations = Math.min(3, stations.length);  // æ”¹æˆéœ€è¦çš„æ•°é‡
```

---

## æ‰©å±•åŠŸèƒ½å»ºè®®

- [ ] æ·»åŠ è½¦å¤´æ–¹å‘æŒ‡ç¤ºå™¨
- [ ] å®æ—¶å®¢æµé‡æ˜¾ç¤º
- [ ] åˆ—è½¦å»¶è¯¯æç¤º
- [ ] å¤©æ°”ä¿¡æ¯æ˜¾ç¤º
- [ ] å¹¿å‘Š/é€šçŸ¥è½®æ’­

---

## è®¸å¯è¯

éµå¾ª Metro PIDS é¡¹ç›®çš„åŸå§‹è®¸å¯è¯
